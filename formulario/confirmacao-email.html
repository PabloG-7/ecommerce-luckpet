<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Email Confirmado - LuckPet</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
    body { font-family: 'Poppins', sans-serif; display:flex; justify-content:center; align-items:center; min-height:100vh; background:#F8F9FA; margin:0; }
    .confirmation-card { background:white; padding:40px; border-radius:12px; box-shadow:0 4px 20px rgba(0,0,0,0.08); text-align:center; max-width:500px; width:90%; }
    .confirmation-title { font-size:28px; color:#1A1A2E; margin-bottom:15px; font-weight:700; }
    .confirmation-message { font-size:18px; color:#666; margin-bottom:30px; }
    .btn-primary { background:#FF6B35; color:white; padding:15px 30px; border:none; border-radius:30px; font-size:16px; text-decoration:none; display:inline-block; }
    .countdown { margin-top:20px; font-size:16px; color:#999; }
</style>
</head>
<body>
<div class="confirmation-card">
    <div class="confirmation-icon">✓</div>
    <h1 class="confirmation-title">Email Confirmado com Sucesso!</h1>
    <p class="confirmation-message">Parabéns! Sua conta foi verificada com sucesso. Redirecionando para a página inicial...</p>
    <a href="https://projeto-luckpet.vercel.app/" class="btn-primary">Ir para a Página Inicial</a>
    <div class="countdown" id="countdown">Redirecionando em <span id="countdown-number">5</span> segundos...</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const SUPABASE_URL = 'https://drbukxyfvbpcqfzykose.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRyYnVreHlmdmJwY3Fmenlrb3NlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYwNjA0MjgsImV4cCI6MjA3MTYzNjQyOH0.HADXFF8pJLkXnwx5Gy-Xz3ccLPHjSFFwmOt6JafZP0I';
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

// Contagem regressiva
let seconds = 5;
const countdownElement = document.getElementById('countdown-number');
const interval = setInterval(() => {
    seconds--;
    countdownElement.textContent = seconds;
    if(seconds <= 0) {
        clearInterval(interval);
        window.location.href = 'https://projeto-luckpet.vercel.app/';
    }
},1000);

// Processar tokens de confirmação e criar perfil
document.addEventListener('DOMContentLoaded', async () => {
    const urlParams = new URLSearchParams(window.location.hash.substring(1));
    const accessToken = urlParams.get('access_token');
    const refreshToken = urlParams.get('refresh_token');

    if(accessToken && refreshToken) {
        try {
            const { data, error } = await supabase.auth.setSession({
                access_token: accessToken,
                refresh_token: refreshToken
            });
            if(error) throw error;

            const user = data.user;
            if(user) {
                // Criar perfil na tabela profiles
                const { error: profileError } = await supabase.from('profiles').insert([{
                    id: user.id,
                    nome: user.user_metadata.nome || '',
                    avatar: user.user_metadata.avatar || '',
                    nivel: 1
                }]);
                if(profileError) console.error('Erro ao criar perfil:', profileError.message);
                else console.log('Perfil criado com sucesso!');
            }

            // Limpar URL
            window.history.replaceState({}, document.title, window.location.pathname);
        } catch(err) {
            console.error('Erro ao processar confirmação:', err);
        }
    }
});
</script>
</body>
</html>
